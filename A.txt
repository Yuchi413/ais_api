app/
  â”œâ”€â”€ app.py                # ä¸»å…¥å£ï¼Œè² è²¬å•Ÿå‹• Flask & Scheduler
  â”œâ”€â”€ config.py             # ç’°å¢ƒè®Šæ•¸ã€DB è·¯å¾‘ã€LINE è¨­å®š
  â”œâ”€â”€ models.py             # SQLAlchemy æ¨¡å‹èˆ‡å»ºè¡¨
  â”œâ”€â”€ database.py           # DB engine/session å»ºç«‹èˆ‡å…±ç”¨å‡½å¼
  â”œâ”€â”€ fetcher.py            # fetch_data èˆ‡çˆ¬èŸ²ç›¸é—œé‚è¼¯
  â”œâ”€â”€ line_push.py          # LINE æ¨æ’­èˆ‡è¨Šæ¯å»é‡
  â”œâ”€â”€ utils.py              # å·¥å…·å‡½å¼ (safe_float, haversine, log_failed_record)
  â”œâ”€â”€ routes/
  â”‚    â”œâ”€â”€ __init__.py      # Blueprint è¨»å†Š
  â”‚    â”œâ”€â”€ api.py           # API endpoints
  â”‚    â””â”€â”€ web.py           # å‰ç«¯é é¢ï¼ˆåœ°åœ–é¡¯ç¤ºï¼‰
  â””â”€â”€ scheduler.py          # APScheduler å®šæ™‚ä»»å‹™


ngrok http 5000




# =========================================
# æ‰‹å‹•æ¸¬è©¦ï¼šå°ä¸­æ¸¯çš„æµ·è­¦èˆ¹ï¼ˆæ‡‰é€²å…¥ 12nmï¼‰
# =========================================

test_ship = {
    "ship_id": "TEST_TAICHUNG",
    "shipname": "CHINACOASTGUARD_TEST12",
    "lat": 24.266,   # å°ä¸­æ¸¯
    "lon": 120.516,
    "timestamp": datetime.utcnow(),
    "speed": 0.0,
    "course": 0.0,
    "heading": 0.0,
    "flag": "CN",
    "shiptype": "TEST",
    "gt_shiptype": "TEST",
}

p = Point(test_ship["lon"], test_ship["lat"])
in_12nm = p.within(TAIWAN_12NM_POLYGON)
in_24nm = p.within(TAIWAN_24NM_POLYGON)

if in_12nm:
    print("âœ… æ¸¬è©¦èˆ¹é€²å…¥ 12nm")
    BoatCheck12Session.add(BoatCheck12AIS(**test_ship))
    CCGCheck12Session.add(CCGCheck12ShipAIS(**test_ship))
elif in_24nm and not in_12nm:
    print("âš ï¸ æ¸¬è©¦èˆ¹åœ¨ 12â€“24nm ä¹‹é–“")
else:
    print("ğŸŒŠ æ¸¬è©¦èˆ¹åœ¨ 24nm å¤–")

BoatSession.add(BoatShipAIS(**test_ship))
CCGSession.add(CCGShipAIS(**test_ship))

# å¯«å…¥è³‡æ–™åº«
BoatSession.commit()
CCGSession.commit()
BoatCheck12Session.commit()
CCGCheck12Session.commit()
print("ğŸ’¾ å·²å¯«å…¥æ¸¬è©¦è³‡æ–™")